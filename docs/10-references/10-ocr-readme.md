# Universal OCR Tool - Phase 1

## 概述
Universal OCR Tool 是 SimaCode 的通用文档识别工具，支持多种文档格式的智能文本提取。

## Phase 1 功能 ✅

### 已实现的核心功能
- **配置管理系统**: 支持 YAML 配置文件
- **Claude Vision 引擎**: 使用 Claude-3.5 Sonnet 进行智能 OCR
- **文件处理**: 支持图片和 PDF 文档处理
- **多页面支持**: 自动将 PDF 转换为图片并逐页处理
- **质量增强**: 图片预处理和质量优化
- **输入验证**: 完整的参数验证和错误处理
- **结果格式化**: 支持 JSON、结构化文本、原始文本输出

### 支持的文件格式
- **图片**: JPG, JPEG, PNG, GIF, WebP, BMP, TIFF
- **文档**: PDF (自动转换为图片处理)

## 安装要求

### 必需依赖
```bash
pip install anthropic  # Claude API 客户端
pip install pydantic   # 数据验证
pip install PyYAML     # 配置文件支持
```

### 可选依赖（用于增强功能）
```bash
pip install pdf2image    # PDF 转换支持
pip install Pillow       # 图片处理和质量增强
```

## 配置

创建配置文件 `.simacode/config.yaml`:

```yaml
# OCR 配置
ocr_claudeai:
  api_key: "your-anthropic-api-key"  # 或设置环境变量 ANTHROPIC_API_KEY
  model: "claude-3-5-sonnet-20241022"
  max_tokens: 4000
  temperature: 0.1
  timeout: 30

# 全局设置
max_file_size: 10485760  # 10MB
```

## 使用方法

### 基本用法

```python
import asyncio
from simacode.tools.universal_ocr import UniversalOCRTool, UniversalOCRInput

async def extract_text():
    # 初始化工具
    ocr_tool = UniversalOCRTool()
    
    # 创建输入参数
    input_data = UniversalOCRInput(
        file_path="/path/to/document.jpg",
        output_format="json"
    )
    
    # 执行 OCR
    async for result in ocr_tool.execute(input_data):
        if result.type.value == "success":
            print("提取成功:")
            print(result.content)

# 运行
asyncio.run(extract_text())
```

### 高级用法

```python
# 使用场景提示提高准确性
input_data = UniversalOCRInput(
    file_path="/path/to/invoice.pdf",
    output_format="structured",
    scene_hint="invoice",
    confidence_threshold=0.8,
    quality_enhancement=True
)

# 自定义提取提示
input_data = UniversalOCRInput(
    file_path="/path/to/document.jpg",
    custom_prompt="请提取所有的姓名、日期和金额信息",
    output_format="json"
)
```

## 输出格式

### JSON 格式
```json
{
  "meta": {
    "file_path": "/path/to/document.jpg",
    "processing_time": 2.34,
    "engine_used": "claude",
    "confidence_score": 0.95
  },
  "extracted_data": {
    "raw_text": "提取的文本内容..."
  }
}
```

### 结构化文本格式
```
=== OCR Extraction Results ===

📋 Processing Information:
  File: document.jpg
  Engine: claude
  Processing Time: 2.34s
  Confidence: 95.0%

📝 Raw Extracted Text:
提取的文本内容...
```

## 状态检查

```python
# 检查工具健康状态
health = await ocr_tool.health_check()
print(f"工具状态: {health['tool_status']}")

# 查看统计信息
stats = ocr_tool.get_statistics()
print(f"处理统计: {stats}")
```

## 故障排查

### 常见问题

1. **"Anthropic package not available"**
   ```bash
   pip install anthropic
   ```

2. **"pdf2image package not available"**
   ```bash
   pip install pdf2image
   ```

3. **"Claude API key not found"**
   - 设置环境变量: `export ANTHROPIC_API_KEY=your-key`
   - 或在配置文件中设置 `ocr_claudeai.api_key`

4. **"File too large"**
   - 默认最大文件大小为 10MB
   - 在配置中调整 `max_file_size` 参数

## 测试

运行基本功能测试:
```python
# 从项目根目录运行
python src/simacode/tools/universal_ocr/test_basic.py
```

## Phase 1 完成状态 ✅

- ✅ 核心 OCR 功能实现
- ✅ Claude Vision 引擎集成
- ✅ 文件处理和格式转换
- ✅ 输入验证和错误处理
- ✅ 多种输出格式支持
- ✅ 基本测试和验证

## 下一步 (Phase 2)

- 场景检测和模板匹配
- 内置模板系统
- 更多 OCR 引擎支持
- 性能优化
- 批量处理功能

---

*Generated by Universal OCR Tool Phase 1 Development*